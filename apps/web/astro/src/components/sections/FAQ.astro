---
import { brand } from '../../config/brand'
---

<section
  id="faq"
  class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-24 sm:py-32"
>
  <div class="space-y-16">
    <div class="text-center">
      <h2 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6">
        <span class="gradient-text">FAQ</span>
      </h2>
      <p class="text-xl text-base-content/80 max-w-2xl mx-auto">
        Common questions about DemoAPPmax.
      </p>
    </div>
    <div class="max-w-3xl mx-auto">
      <div class="space-y-4" id="faq-container">
        {brand.faq.map((item, index) => (
          <div class="faq-item rounded-xl overflow-hidden card-block backdrop-blur-md shadow-xl hover:shadow-2xl transition-all" data-faq-item={index}>
            <button
              type="button"
              class="faq-button flex items-center justify-between w-full px-6 py-5 cursor-pointer hover:bg-base-content/10 transition-colors text-left"
              data-faq-button={index}
              aria-expanded="false"
            >
              <span class="text-lg font-semibold text-base-content pr-4">{item.question}</span>
              <svg
                class="faq-arrow w-5 h-5 text-base-content/70 transition-transform duration-300 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="faq-content" data-faq-content={index}>
              <div class="px-6 pb-5">
                <p class="text-base text-base-content/70 leading-relaxed">{item.answer}</p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  /* FAQ Content - hidden by default */
  .faq-content {
    display: none;
    overflow: hidden;
  }
  
  /* FAQ Content - visible ONLY when parent has active class */
  .faq-item.active .faq-content {
    display: block !important;
  }
  
  /* Force hide content if parent is not active */
  .faq-item:not(.active) .faq-content {
    display: none !important;
  }
  
  /* Arrow rotation when active */
  .faq-item.active .faq-arrow {
    transform: rotate(180deg);
  }
</style>

<script is:inline>
  // FAQ Accordion - Simple and reliable
  (function() {
    function setupFAQ() {
      var container = document.getElementById('faq-container');
      if (!container) {
        setTimeout(setupFAQ, 100);
        return;
      }
      
      // CRITICAL: Close ALL items first
      var allItems = container.querySelectorAll('[data-faq-item]');
      for (var k = 0; k < allItems.length; k++) {
        allItems[k].classList.remove('active');
        var btn = allItems[k].querySelector('[data-faq-button]');
        if (btn) {
          btn.setAttribute('aria-expanded', 'false');
        }
      }
      
      // Open first item by default
      var firstItem = container.querySelector('[data-faq-item="0"]');
      if (firstItem) {
        firstItem.classList.add('active');
        var firstButton = firstItem.querySelector('[data-faq-button="0"]');
        if (firstButton) {
          firstButton.setAttribute('aria-expanded', 'true');
        }
      }
      
      // Add click handlers to all buttons
      var buttons = container.querySelectorAll('[data-faq-button]');
      for (var i = 0; i < buttons.length; i++) {
        var btn = buttons[i];
        var btnIndex = btn.getAttribute('data-faq-button');
        
        // Create closure to preserve index and button reference
        (function(index, button) {
          button.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var currentItem = container.querySelector('[data-faq-item="' + index + '"]');
            if (!currentItem) return;
            
            // Check if item is open BEFORE closing all
            var isOpen = currentItem.classList.contains('active');
            
            // Close ALL items first
            var allItems = container.querySelectorAll('[data-faq-item]');
            for (var j = 0; j < allItems.length; j++) {
              allItems[j].classList.remove('active');
              var btnItem = allItems[j].querySelector('[data-faq-button]');
              if (btnItem) {
                btnItem.setAttribute('aria-expanded', 'false');
              }
            }
            
            // If clicked item was closed, open it
            if (!isOpen) {
              currentItem.classList.add('active');
              button.setAttribute('aria-expanded', 'true');
            }
          };
        })(btnIndex, btn);
      }
    }
    
    // Initialize
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupFAQ);
    } else {
      setupFAQ();
    }
    
    // Fallback
    window.addEventListener('load', function() {
      setTimeout(setupFAQ, 50);
    });
  })();
</script>
