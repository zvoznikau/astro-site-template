<button
  class="theme-toggle-btn p-2 rounded-lg text-base-content/70 hover:text-base-content hover:bg-base-content/10 transition-colors"
  aria-label="Toggle theme"
  title="Toggle theme"
>
  <!-- Sun icon (light theme) -->
  <svg
    class="w-5 h-5 theme-icon-light"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    stroke-width="2"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
    />
  </svg>
  <!-- Moon icon (dark theme) -->
  <svg
    class="w-5 h-5 theme-icon-dark hidden"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    stroke-width="2"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
    />
  </svg>
</button>

<script>
  (function() {
    // Save theme to localStorage
    function saveTheme(theme) {
      try {
        localStorage.setItem('theme', theme);
      } catch (e) {
        // Silently fail if localStorage is unavailable
      }
    }
    
    // Get current theme
    function getCurrentTheme() {
      return document.documentElement.dataset.theme || 'dark';
    }
    
    // Toggle theme and save to localStorage
    function toggleTheme() {
      const currentTheme = getCurrentTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.dataset.theme = newTheme;
      saveTheme(newTheme);
      updateThemeIcon();
    }
    
    // Update icon visibility based on current theme (all instances)
    function updateThemeIcon() {
      const theme = getCurrentTheme();
      const lightIcons = document.querySelectorAll('.theme-icon-light');
      const darkIcons = document.querySelectorAll('.theme-icon-dark');
      
      if (theme === 'dark') {
        lightIcons.forEach(icon => icon.classList.add('hidden'));
        darkIcons.forEach(icon => icon.classList.remove('hidden'));
      } else {
        lightIcons.forEach(icon => icon.classList.remove('hidden'));
        darkIcons.forEach(icon => icon.classList.add('hidden'));
      }
    }
    
    // Initialize: load saved theme
    function initTheme() {
      try {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light' || savedTheme === 'dark') {
          document.documentElement.dataset.theme = savedTheme;
        }
      } catch (e) {
        // Silently fail if localStorage is unavailable
      }
      updateThemeIcon();
    }
    
    // Use event delegation to handle clicks on all theme toggle buttons
    // This works for both existing and dynamically added buttons
    document.addEventListener('click', (e) => {
      const toggleBtn = e.target.closest('.theme-toggle-btn');
      if (toggleBtn) {
        e.stopPropagation();
        toggleTheme();
      }
    });
    
    // Watch for theme changes (from other sources)
    const observer = new MutationObserver(() => {
      updateThemeIcon();
      saveTheme(getCurrentTheme());
    });
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-theme']
    });
    
    // Initial setup
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTheme);
    } else {
      initTheme();
    }
  })();
</script>
